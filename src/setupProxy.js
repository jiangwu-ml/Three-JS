const proxy = require("http-proxy-middleware");
// http://123.60.160.90:8082/

// å‰ç«¯ä»£ç†çš„åŸç†ï¼š https://juejin.cn/post/6993644913900388359

module.exports = function (app) {
  app.use(
    // ä»£ç† 1
    proxy.createProxyMiddleware("/api", {
      // åŒ¹é…åˆ° '/api' å‰ç¼€çš„è¯·æ±‚ï¼Œå°±ä¼šè§¦å‘è¯¥ä»£ç†é…ç½®
      target: "http://123.60.160.90:8082/", // è¯·æ±‚è½¬å‘åœ°å€
      changeOrigin: true, // æ˜¯å¦è·¨åŸŸ
      /*
        changeOrigin ä¸º true æ—¶ï¼ŒæœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚å¤´ä¸­çš„hostä¸ºï¼š127.0.0.1:6000ï¼Œä¹Ÿå°±æ˜¯ä»£ç†åœ°å€çš„ host
        changeOrigin ä¸º false æ—¶ï¼ŒæœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚å¤´ä¸­çš„hostä¸ºï¼šlocalhost:3000ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°ç«™ç‚¹åœ°å€çš„ host
        changeOrigin é»˜è®¤ falseï¼Œä½†ä¸€èˆ¬éœ€è¦å°† changeOrigin å€¼è®¾ä¸º trueï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚è°ƒæ•´
      */
      pathRewrite: {
        "^/api": "/",
        /* é‡å†™è¯·æ±‚è·¯å¾„ã€‚ æ„ä¸ºï¼šä¼šæŠŠ/apiæ›¿æ¢æˆæŒ‡å®šçš„å€¼ï¼Œæ­¤å¤„å°±æ˜¯æŠŠ/apiå»æ‰ã€‚ã€‚
                      å¦‚æœå€¼ä¸ºï¼š"^/api": "/abc123" é‚£ä¹ˆä»£ç†æœåŠ¡å™¨çš„çœŸå®è¯·æ±‚åœ°å€ä¸ºï¼šhttp://123.60.160.90:8082/abc123/xxx
                      ğŸ“¢éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ğŸ“¢ï¼šğŸ™„ğŸ™„ğŸ™„  æµè§ˆå™¨ç»™ä½ å±•ç¤ºçš„æ˜¯  ä¸ä¼šå±•ç¤º çœŸå®çš„ä»£ç†è·¯å¾„ ï¼Œ
                                        æµè§ˆå™¨ç»™ä½ å±•ç¤ºçš„æ ·å­ http://localhost:3000/api/xxx
                    */
      },
    }),
    // ä»£ç† 2ï¼Œä¸ºä»€ä¹ˆ 2 å†™å‰é¢ï¼Œå› ä¸ºåŒ¹é…è§„åˆ™ï¼Œä¸Šé¢ç¬¬ä¸€ä¸ªå·²ç»æ˜¯ /api äº†ï¼Œè¦ä¸ç„¶ä¼šä¼˜å…ˆåŒ¹é…åˆ°ç¬¬ä¸€ä¸ªä»£ç†ä¸Š
    proxy.createProxyMiddleware("/2api", {
      target: "http://127.0.0.1:6000/api",
      changeOrigin: true,
      pathRewrite: {
        "^/2api": "",
      },
    }),
    // ä»£ç† 3ï¼Œè¿™ç§å†™æ³•æ˜¯æœ€è§„èŒƒçš„ï¼Œå‰åéƒ½åŠ  /
    proxy.createProxyMiddleware("/3api/", {
      target: "http://127.0.0.1:6000/api/",
      changeOrigin: true,
      pathRewrite: {
        "^/3api/": "",
      },
    }),
    // ä»£ç† 4ï¼Œè¿™ç§ä»£ç†æ ‡è¯†å°¾éƒ¨åŠ  / ï¼Œä»£ç†åœ°å€å°¾éƒ¨æ²¡æœ‰
    proxy.createProxyMiddleware("/4api/", {
      target: "http://127.0.0.1:6000/api",
      changeOrigin: true,
      pathRewrite: {
        // '^/4api/': ''  // è¿™ç§æ›¿æ¢æˆç©ºï¼Œä¹Ÿæ²¡é—®é¢˜ï¼Œä½†æ˜¯ä¸ä¸¥è°¨
        "^/4api/": "/", // è¿™æ ·å†™æ›´è§„èŒƒ
      },
    })
  );
};
